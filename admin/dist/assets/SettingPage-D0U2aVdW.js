import{_ as W}from"./Header-C_d6U9Mw.js";import{F as X}from"./Footer-DigKJm0u.js";import{i as C}from"./axios-Dkq8iht1.js";import{s as Y,r as v,o as Z,l as A,a as ee,b as u,c as _,d as D,w as o,e as a,g as y,h as d,j as h,F as te,t as ae,i as z,m as B,K as oe,G as S}from"./index-BIJFk_Lq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={style:{background:"#fff",padding:"12px",minHeight:"calc(100vh - 170px)"}},le=y("h3",null,"Cài đặt",-1),ue={key:0},se={key:1,class:"editable-row-operations"},ce={key:0},ie=y("a",{style:{color:"red"}},"Hủy",-1),de={key:1},re={key:0},ve=["onClick"],ye={__name:"SettingPage",setup(_e){Y(),v(null);const F=v([]),r=v({total:0,pageSize:10,current:1,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`Tổng kết qủa ${e} kết quả`}),k=v(!1),b=v(null);Z(()=>{C.get("/me/profile").then(e=>{b.value=e.user,T(),g(r.value)})});const c=v({username:"",value:""}),w=v({value:"1.98"}),x=v([{name:"game",value:"1.98",userId:1}]),N=[{title:"Giá trị",dataIndex:"value",key:"value"},{title:"Người dùng",dataIndex:"userId",key:"userId"},{title:"Tạo ngày",dataIndex:"createAt",key:"createAt",customRender:e=>A(e.text)},{title:"Hành động",dataIndex:"operation",align:"center"}],g=e=>{k.value=!0,C.get("/setting",{params:{page:e.current,limit:e.pageSize,username:c.value.username?c.value.username:null,value:c.value.value?c.value.value:null}}).then(t=>{const n=t;x.value=n.docs.map((l,p)=>{var f;return{...l,key:l._id,createdAt:A(l.createdAt),value:l.value,userId:(f=l==null?void 0:l.user)==null?void 0:f.username}}),r.value={...r.value,total:t.totalDocs+1,pageSize:t.limit,current:t.page,showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`Tổng kết qủa ${t.totalDocs} kết quả`},k.value=!1}).catch(t=>{console.log(t),k.value=!1})},q=e=>{g(e)},V=e=>{g({...r.value,current:1})},T=async()=>{const e=await C.get("/users/list");F.value=e.docs,console.log(F.value)},i=ee({}),H=e=>{i[e]=B(x.value.filter(t=>e===t.key)[0])},j=e=>{Object.assign(x.value.filter(n=>e===n.key)[0],i[e]),console.log(i[e]);const t=B(i[e]);console.log(t),t.userId=t.user._id,C.put(`/setting/${e}`,t).then(n=>{console.log(n),oe.emit("update-setting",{userId:t.userId,value:t.value}),g({...r.value})}).catch(n=>{console.log(n)}),delete i[e]},G=e=>{delete i[e],T(),g(r.value)},J=e=>{console.log("Success:",e);const t=S.load(2);C.post("/setting/update-all",e).then(n=>{console.log(n),g({...r.value,current:1}),S.msg("Cập nhật thành công",{icon:1})}).catch(n=>{console.log(n),S.msg(n.response.data.message,{icon:2})}).finally(()=>{S.close(t)})};return(e,t)=>{const n=u("a-input-search"),l=u("a-form-item"),p=u("a-select-option"),f=u("a-select"),U=u("a-form"),$=u("a-col"),K=u("a-button"),L=u("a-row"),O=u("a-typography-link"),Q=u("a-popconfirm"),R=u("a-table"),E=u("a-layout-content"),M=u("a-layout");return _(),D(M,null,{default:o(()=>[a(W,{selectedKeys:["4"]}),a(E,{style:{padding:"20px 50px"}},{default:o(()=>[y("div",ne,[le,a(L,{gutter:"10"},{default:o(()=>[a($,{span:12},{default:o(()=>[a(U,{layout:"vertical",model:c.value,autocomplete:"off",onFinish:e.onFinish},{default:o(()=>[a(l,{value:c.value.username,"onUpdate:value":t[0]||(t[0]=s=>c.value.username=s)},{default:o(()=>[a(n,{onSearch:V,placeholder:"Tìm kiếm",loading:k.value,"enter-button":""},null,8,["loading"])]),_:1},8,["value"]),a(l,{value:c.value.value,"onUpdate:value":t[2]||(t[2]=s=>c.value.value=s)},{default:o(()=>[a(f,{value:c.value.value,"onUpdate:value":t[1]||(t[1]=s=>c.value.value=s),placeholder:"Chọn giá trị"},{default:o(()=>[a(p,{value:"1.98"},{default:o(()=>[d("1.98")]),_:1}),a(p,{value:"2.1"},{default:o(()=>[d("2.1")]),_:1})]),_:1},8,["value"])]),_:1},8,["value"])]),_:1},8,["model","onFinish"])]),_:1}),a($,{span:12},{default:o(()=>[a(U,{layout:"vertical",model:w.value,autocomplete:"off",onFinish:J},{default:o(()=>[a(l,{name:"value"},{default:o(()=>[a(f,{value:w.value.value,"onUpdate:value":t[3]||(t[3]=s=>w.value.value=s),placeholder:"Chọn giá trị"},{default:o(()=>[a(p,{value:"1.98"},{default:o(()=>[d("1.98")]),_:1}),a(p,{value:"2.1"},{default:o(()=>[d("2.1")]),_:1})]),_:1},8,["value"])]),_:1}),a(l,null,{default:o(()=>[a(K,{style:{width:"100%"},type:"primary","html-type":"submit"},{default:o(()=>[d("Cập nhật tất cả")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),a(R,{columns:N,dataSource:x.value,pagination:r.value,loading:k.value,onChange:q},{bodyCell:o(({column:s,text:P,record:m})=>[["value"].includes(s.dataIndex)?(_(),h("div",ue,[i[m.key]?(_(),D(f,{key:0,value:i[m.key][s.dataIndex],"onUpdate:value":I=>i[m.key][s.dataIndex]=I,style:{margin:"-5px 0"}},{default:o(()=>[a(p,{value:"1.98"},{default:o(()=>[d("1.98")]),_:1}),a(p,{value:"2.1"},{default:o(()=>[d("2.1")]),_:1})]),_:2},1032,["value","onUpdate:value"])):(_(),h(te,{key:1},[d(ae(P),1)],64))])):s.dataIndex==="operation"?(_(),h("div",se,[i[m.key]?(_(),h("span",ce,[y("div",null,[a(O,{style:{color:"green"},onClick:I=>j(m.key)},{default:o(()=>[d("Lưu")]),_:2},1032,["onClick"])]),y("div",null,[a(Q,{title:"Bạn có muốn hủy thao thác?",onConfirm:I=>G(m.key)},{default:o(()=>[ie]),_:2},1032,["onConfirm"])])])):(_(),h("span",de,[b.value&&b.value.permissions.setting.includes("edit")?(_(),h("div",re,[y("a",{onClick:I=>H(m.key)},"Chỉnh sửa",8,ve)])):z("",!0)]))])):z("",!0)]),_:1},8,["dataSource","pagination","loading"])])]),_:1}),a(X)]),_:1})}}};export{ye as default};
