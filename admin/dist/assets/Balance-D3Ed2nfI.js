import{_ as B}from"./Header-C_d6U9Mw.js";import{F as L}from"./Footer-DigKJm0u.js";import{i as g}from"./axios-Dkq8iht1.js";import{r as p,o as S,b as o,c as v,d as h,w as t,e as a,g as f,j as N,k as q,F as D,h as m,t as b,u as K,G as c,K as T,f as $}from"./index-BIJFk_Lq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const j={style:{background:"#fff",padding:"12px",minHeight:"calc(100vh - 170px)"}},E=f("h3",null,"Công trừ tiền",-1),G={class:"notranslate"},P={__name:"Balance",setup(H){const l=p({userId:"",balance:"",note:"",type:"add"}),_=p([]),y=async()=>{const s=await g.get("/users/list",{params:{limit:1e3,page:1}});_.value=s.docs},F=s=>{const e={...s};if(e.type==="sub"&&i.value.balance<e.balance){c.msg("Số dư không đủ",{icon:2,time:1500});return}const r=c.load(1);g.put(`/users/update-balance/${e.userId}`,e).then(u=>{c.msg("Cập nhật thành công",{icon:1,time:1500}),i.value=u,T.emit("update-balance",{userId:e.userId,balance:u.balance})}).catch(u=>{c.msg("Cập nhật thất bại",{icon:2,time:1500})}).finally(()=>{c.close(r)})},i=p(""),C=s=>{i.value=_.value.find(e=>e._id===s)};return S(()=>{y()}),(s,e)=>{const r=o("a-select-option"),u=o("a-select"),d=o("a-form-item"),I=o("a-input-number"),k=o("a-input"),w=o("a-button"),x=o("a-form"),U=o("a-layout-content"),V=o("a-layout");return v(),h(V,null,{default:t(()=>[a(B,{selectedKeys:["7"]}),a(U,{style:{padding:"20px 50px"}},{default:t(()=>[f("div",j,[E,a(x,{layout:"vertical",model:l.value,onFinish:F,onFinishFailed:s.onFinishFailed},{default:t(()=>[a(d,{name:"userId",label:"Người dùng",rules:[{required:!0,message:"Vui lòng nhập ID người dùng"}]},{default:t(()=>[a(u,{onChange:C,"show-search":"",value:l.value.userId,"onUpdate:value":e[0]||(e[0]=n=>l.value.userId=n),style:{width:"100%"}},{default:t(()=>[(v(!0),N(D,null,q(_.value,n=>(v(),h(r,{key:n._id,value:n._id},{default:t(()=>[f("div",G,b(n.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),m(" "+b(i.value?"số dư người dùng: "+K($)(i.value.balance):""),1)]),_:1}),a(d,{name:"type",label:"Công hoặc trừ",rules:[{required:!0,message:"Vui lòng nhập ID người dùng"}]},{default:t(()=>[a(u,{value:l.value.type,"onUpdate:value":e[1]||(e[1]=n=>l.value.type=n),style:{width:"100%"}},{default:t(()=>[a(r,{value:"add"},{default:t(()=>[m("Cộng")]),_:1}),a(r,{value:"sub"},{default:t(()=>[m("Trừ")]),_:1})]),_:1},8,["value"])]),_:1}),a(d,{name:"balance",label:"Số tiền",rules:[{required:!0,message:"Vui lòng nhập số tiền"}]},{default:t(()=>[a(I,{value:l.value.balance,"onUpdate:value":e[2]||(e[2]=n=>l.value.balance=n),style:{width:"100%"}},null,8,["value"])]),_:1}),a(d,{name:"note",label:"Lý do"},{default:t(()=>[a(k,{value:l.value.note,"onUpdate:value":e[3]||(e[3]=n=>l.value.note=n)},null,8,["value"])]),_:1}),a(d,null,{default:t(()=>[a(w,{type:"primary","html-type":"submit"},{default:t(()=>[m("Công trừ")]),_:1})]),_:1})]),_:1},8,["model","onFinishFailed"])])]),_:1}),a(L)]),_:1})}}};export{P as default};
