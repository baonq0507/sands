import{_ as X}from"./Header-C_d6U9Mw.js";import{F as Y}from"./Footer-DigKJm0u.js";import{i as R}from"./axios-Dkq8iht1.js";import{r as m,a as Z,o as ee,b as c,c as u,d as k,w as l,e as o,g,h as i,j as p,F as C,t as T,i as f,f as D,l as te,m as ae,G as ne,p as oe,q as se}from"./index-BIJFk_Lq.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U=x=>(oe("data-v-070c581a"),x=x(),se(),x),ue={style:{background:"#fff",padding:"12px",minHeight:"calc(100vh - 170px)"}},de=U(()=>g("h3",null,"Quản lý nạp rút",-1)),ce=U(()=>g("p",null,"Tìm kiếm theo ngày",-1)),ie={key:0},pe={key:1},re={key:2},_e={key:3},ye={key:4,class:"editable-row-operations"},he={key:0},ge=U(()=>g("a",{style:{color:"red"}},"Hủy",-1)),ve={key:1},me={key:0},ke=["onClick"],fe={__name:"RequestMoney",setup(x){const _=m([]),$=[{title:"Tên đăng nhập",dataIndex:"username",key:"username",scopedSlots:{customRender:"username"}},{title:"Số tiền",dataIndex:"amount",key:"amount",customRender:(e,a)=>D(e.text)},{title:"Số dư trước",dataIndex:"beforeBalance",key:"balance",customRender:(e,a)=>D(e.text)},{title:"Số dư sau",dataIndex:"afterBalance",key:"balance",customRender:(e,a)=>D(e.text)},{title:"Trạng thái",dataIndex:"status",key:"status"},{title:"Trạng thái sử lý",dataIndex:"statusProcess",key:"statusProcess",customRender:e=>e.text==0?"Đang chờ":"Đã xử lý"},{title:"Tạo ngày",dataIndex:"createAt",key:"createAt",customRender:e=>te(e.text)},{title:"Ghi chú",dataIndex:"note",key:"note"},{title:"Lý do",dataIndex:"reson",key:"reson"},{title:"Nạp/Rút",dataIndex:"type",key:"type"},{title:"Hành động",dataIndex:"operation"}],n=Z({}),z=e=>{n[e]=ae(_.value.filter(a=>e===a.key)[0])},w=m(""),V=e=>{Object.assign(_.value.filter(a=>e===a.key)[0],n[e]),console.log(n[e]),R.put(`/users/update-request-money/${e}`,n[e]).then(a=>{ne.msg("Lưu thành công",{icon:1,time:3e3});const y=_.value.find(t=>t.key===e);_.value=_.value.map(t=>t.key===e?{...t,...n[e],username:y.username,status:t.status=="pending"?"Đang chờ":t.status=="accept"?"Đã chấp nhận":"Từ chối",type:t.type=="deposit"?"Nạp tiền":"Rút tiền"}:t)}).catch(a=>{console.log(a)}),delete n[e]},F=e=>{delete n[e]},N=m([]),q=m({current:1,pageSize:10,total:_.value.length,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`Total ${e} items`}),v=e=>{R.get("/users/get-request-money",{params:{page:e.current,limit:e.pageSize,type:e.type||null,username:e.username||null,fromDate:e.fromDate||null,toDate:e.toDate||null}}).then(a=>{const y=a;_.value=y.docs.map((t,h)=>({...t,key:t._id,username:t!=null&&t.user?t.user.username:"",status:t.status=="pending"?"Đang chờ":t.status=="accept"?"Đã chấp nhận":"Từ chối",type:t.type=="deposit"?"Nạp tiền":"Rút tiền"})),q.value={current:y.page,pageSize:y.limit,total:y.totalDocs,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`Tổng kết qủa ${a.totalDocs} kết quả`}}).catch(a=>{console.log(a)})},M=e=>{console.log(e),v(e)},B=m(""),P=e=>{v({page:1,limit:10,username:e})},S=m(null);ee(()=>{R.get("/me/profile").then(e=>{S.value=e.user}),v({page:1,limit:10})});const j=e=>{w.value=e,v({type:e})},A=e=>{e&&e.length>0?v({fromDate:e[0],toDate:e[1]}):v({page:1,limit:10})};return(e,a)=>{const y=c("a-input-search"),t=c("a-col"),h=c("a-select-option"),b=c("a-select"),H=c("a-range-picker"),L=c("a-row"),Q=c("a-input"),G=c("a-textarea"),J=c("a-typography-link"),K=c("a-popconfirm"),O=c("a-table"),E=c("a-layout-content"),W=c("a-layout");return u(),k(W,null,{default:l(()=>[o(X,{selectedKeys:["5"]}),o(E,{style:{padding:"20px 50px"}},{default:l(()=>[g("div",ue,[de,o(L,{gutter:"10",style:{margin:"10px 0"}},{default:l(()=>[o(t,{span:12},{default:l(()=>[o(y,{value:B.value,"onUpdate:value":a[0]||(a[0]=s=>B.value=s),onSearch:P,placeholder:"Tìm kiếm theo tên người dùng","enter-button":""},null,8,["value"])]),_:1}),o(t,{span:12},{default:l(()=>[o(b,{value:w.value,"onUpdate:value":a[1]||(a[1]=s=>w.value=s),style:{width:"100%"},placeholder:"Chọn tình trạng",onChange:j,allowClear:""},{default:l(()=>[o(h,{value:"deposit"},{default:l(()=>[i("Nạp tiền")]),_:1}),o(h,{value:"withdraw"},{default:l(()=>[i("Rút tiền")]),_:1})]),_:1},8,["value"])]),_:1}),o(t,{span:24,style:{"margin-top":"10px"}},{default:l(()=>[ce,o(H,{value:N.value,"onUpdate:value":a[2]||(a[2]=s=>N.value=s),onChange:A},null,8,["value"])]),_:1})]),_:1}),o(O,{columns:$,"data-source":_.value,bordered:"",pagination:q.value,onChange:M},{bodyCell:l(({column:s,text:I,record:d})=>[["balance","phone","email"].includes(s.dataIndex)?(u(),p("div",ie,[n[d.key]?(u(),k(Q,{key:0,value:n[d.key][s.dataIndex],"onUpdate:value":r=>n[d.key][s.dataIndex]=r,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(u(),p(C,{key:1},[i(T(I),1)],64))])):f("",!0),["status"].includes(s.dataIndex)?(u(),p("div",pe,[n[d.key]?(u(),k(b,{key:0,value:n[d.key][s.dataIndex],"onUpdate:value":r=>n[d.key][s.dataIndex]=r,style:{margin:"-5px 0"}},{default:l(()=>[o(h,{value:"pending"},{default:l(()=>[i("Đang chờ")]),_:1}),o(h,{value:"accept"},{default:l(()=>[i("Chấp nhận")]),_:1}),o(h,{value:"reject"},{default:l(()=>[i("Từ chối")]),_:1})]),_:2},1032,["value","onUpdate:value"])):(u(),p(C,{key:1},[i(T(I),1)],64))])):f("",!0),["role"].includes(s.dataIndex)?(u(),p("div",re,[n[d.key]?(u(),k(b,{key:0,value:n[d.key][s.dataIndex],"onUpdate:value":r=>n[d.key][s.dataIndex]=r,style:{margin:"-5px 0"}},{default:l(()=>[o(h,{value:"admin"},{default:l(()=>[i("Admin")]),_:1}),o(h,{value:"user"},{default:l(()=>[i("Người dùng")]),_:1})]),_:2},1032,["value","onUpdate:value"])):(u(),p(C,{key:1},[i(T(I),1)],64))])):f("",!0),["note"].includes(s.dataIndex)?(u(),p("div",_e,[n[d.key]?(u(),k(G,{key:0,value:n[d.key][s.dataIndex],"onUpdate:value":r=>n[d.key][s.dataIndex]=r,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(u(),p(C,{key:1},[i(T(I),1)],64))])):s.dataIndex==="operation"?(u(),p("div",ye,[n[d.key]?(u(),p("span",he,[g("div",null,[o(J,{style:{color:"green"},onClick:r=>V(d.key)},{default:l(()=>[i("Lưu")]),_:2},1032,["onClick"])]),g("div",null,[o(K,{title:"Bạn có muốn hủy thao thác?",onConfirm:r=>F(d.key),"ok-text":"OK","cancel-text":"Tiếp tục"},{default:l(()=>[ge]),_:2},1032,["onConfirm"])])])):(u(),p("span",ve,[S.value&&S.value.permissions.requestMoney.includes("edit")?(u(),p("div",me,[g("a",{onClick:r=>z(d.key)},"Chỉnh sửa",8,ke)])):f("",!0)]))])):f("",!0)]),_:1},8,["data-source","pagination"])])]),_:1}),o(Y)]),_:1})}}},Se=le(fe,[["__scopeId","data-v-070c581a"]]);export{Se as default};
