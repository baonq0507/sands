import{_ as E}from"./Header-C_d6U9Mw.js";import{F as X}from"./Footer-DigKJm0u.js";import{i as y}from"./axios-Dkq8iht1.js";import{s as Y,r as c,a as Z,o as ee,K as k,G as z,m as x,v as te,b as n,c as N,d as B,w as s,e as o,g as u,t as U,u as ae,h as oe,i as ne,l as M}from"./index-BIJFk_Lq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se={style:{background:"#fff",padding:"12px",minHeight:"100vh"}},le={class:"game_controll",style:{"margin-top":"10px"}},ce={id:"controll"},ue={id:"onBet"},ge={__name:"GameControll",setup(re){const R=Y(),S=c(null),r=R.currentRoute.value.params.code,i=c({}),T=Z({betData:""}),_=c([]),V=c("top"),A=t=>{},K=t=>{const e={betData:t.betData,sessionID:i.value._id};k.emit("controllgame",e)},O=t=>{console.log("Failed:",t)},v=t=>{const e={1:"Lớn",2:"Nhỏ",3:"Lẻ",4:"Chẵn"};return t.map(a=>{var m;const l=(m=a==null?void 0:a.user)==null?void 0:m.username,b=["số đầu tiên","số thứ hai","số thứ ba","số thứ tư","số thứ năm"],f=a.betInUser.map((p,h)=>{const C=b[h]||`số thứ ${h+1}`,w=e[p.value]||`value ${p.value}`;return`${C}: ${w}`}).join(`
`);return console.log(a),{...a,resultSession:a!=null&&a.betData?a.betData.betData.join(","):"",username:l,betInUserText:f,id:a!=null&&a.betData?a.betData.id:""}})},J=t=>{t==2&&y.get(`/history/get/${r}`).then(e=>{const a=v(e.docs);console.log(a),D.value=x(a),d.value={...d.value,total:e.totalDocs+1,pageSize:e.limit,current:e.page,showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`Tổng kết qủa ${e.totalDocs} kết quả`}}).catch(e=>{console.log(e)})},D=c([]),I=async(t={})=>{const e={...t,gameCode:r};console.log(e);const a=await y.get(`/history/get/${r}`,{params:e}),l=v(a.docs);console.log(l),D.value=x(l),d.value={...d.value,total:a.totalDocs+1,pageSize:a.limit,current:a.page,showSizeChanger:!0,showQuickJumper:!0,showTotal:b=>`Tổng kết qủa ${a.totalDocs} kết quả`}},L=(t,e,a)=>{I({results:t.pageSize,page:t==null?void 0:t.current,sortField:a.field,sortOrder:a.order,...e})},Q=[{title:"Người dùng",dataIndex:"username",key:"username"},{title:"Tiền cược",dataIndex:"amount",key:"amount"},{title:"Số đặt cược",dataIndex:"betInUserText",key:"betInUserText"},{title:"Thời gian",dataIndex:"createAt",key:"createAt",customRender:t=>M(t.text)}],j=[{title:"Phiên ID",dataIndex:"id",key:"id"},{title:"Người dùng",dataIndex:"username",key:"username"},{title:"Tiền cược",dataIndex:"amount",key:"amount"},{title:"Số dư trước cược",dataIndex:"balanceBefore",key:"beforeOnWin"},{title:"Số tiền thay đổi",dataIndex:"interest",key:"interest"},{title:"Số dư sau cược",dataIndex:"balanceAfter",key:"afterOnWin"},{title:"Số đặt cược",dataIndex:"betInUserText",key:"betInUserText"},{title:"kết quả phiên",dataIndex:"resultSession",key:"resultSession"},{title:"Thời gian",dataIndex:"createAt",key:"createAt",customRender:t=>M(t.text)}],d=c({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`Tổng kết qủa ${t} kết quả`});ee(()=>{y("/me/profile").then(t=>{S.value=t.user,k.on(r,async e=>{i.value=e}),k.on("controllgameResponse",async e=>{console.log(e),e.status==="success"?(z.msg("Cập nhật thành công",{icon:1,time:3e3}),console.log(e.data),i.value=e.data):z.msg("Cập nhật thất bại",{icon:2,time:3e3})}),k.on(`betDataUser-${r}`,async e=>{const a=x(_.value);a.push(e.historyBetList);const l=v(a);console.log(l),_.value=l})}).catch(t=>{console.log(t)})}),te(()=>i.value._id,t=>{t&&y.get(`/history/id/${t}`).then(e=>{const a=v(e);_.value=x(a)}).catch(e=>{console.log(e)})});const $=c(""),G=t=>{I({username:t})},q=c(""),H=t=>{I({search:t})};return(t,e)=>{const a=n("a-input"),l=n("a-form-item"),b=n("a-button"),F=n("a-form"),f=n("a-table"),m=n("a-tab-pane"),p=n("a-input-search"),h=n("a-col"),C=n("a-row"),w=n("a-tabs"),W=n("a-layout-content"),P=n("a-layout");return N(),B(P,null,{default:s(()=>[o(E,{selectedKeys:[2]}),o(W,{style:{padding:"20px 50px"}},{default:s(()=>[u("div",se,[u("h3",null,"game "+U(ae(r)),1),u("div",le,[u("p",null,"thời gian: "+U(i.value.timeRemain),1),u("p",null,"Kêt quả: "+U(i.value.betData),1),u("div",ce,[S.value&&S.value.permissions.game.includes("edit")?(N(),B(F,{key:0,model:T,name:"basic","wrapper-col":{span:8},autocomplete:"off",onFinish:K,onFinishFailed:O},{default:s(()=>[o(l,{label:"Kết quả mới",name:"betData",rules:[{required:!0,message:"Vui lòng nhập kết quả"}]},{default:s(()=>[o(a,{value:T.betData,"onUpdate:value":e[0]||(e[0]=g=>T.betData=g),placeholder:"1,2,3,4,5"},null,8,["value"])]),_:1}),o(l,null,{default:s(()=>[o(b,{type:"primary","html-type":"submit"},{default:s(()=>[oe("Cập nhật")]),_:1})]),_:1})]),_:1},8,["model"])):ne("",!0)]),u("div",ue,[o(w,{onChange:J,"tab-position":V.value,onTabScroll:A},{default:s(()=>[o(m,{key:"1",tab:"Hiện tại"},{default:s(()=>[o(f,{columns:Q,"data-source":_.value,bordered:""},null,8,["data-source"])]),_:1}),o(m,{key:"2",tab:"Tất cả"},{default:s(()=>[o(C,{gutter:"10"},{default:s(()=>[o(h,{span:12},{default:s(()=>[o(p,{style:{"margin-bottom":"10px"},value:$.value,"onUpdate:value":e[1]||(e[1]=g=>$.value=g),onSearch:G,placeholder:"Tìm kiếm người dùng"},null,8,["value"])]),_:1}),o(h,{span:12,style:{"text-align":"right"}},{default:s(()=>[o(p,{style:{"margin-bottom":"10px"},value:q.value,"onUpdate:value":e[2]||(e[2]=g=>q.value=g),onSearch:H,placeholder:"Tìm kiếm khác"},null,8,["value"])]),_:1})]),_:1}),o(f,{onChange:L,columns:j,"data-source":D.value,bordered:"",pagination:d.value},null,8,["data-source","pagination"])]),_:1})]),_:1},8,["tab-position"])])])])]),_:1}),o(X)]),_:1})}}};export{ge as default};
