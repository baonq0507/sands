import{_ as ke}from"./Header-C_d6U9Mw.js";import{F as fe}from"./Footer-DigKJm0u.js";import{i as C}from"./axios-Dkq8iht1.js";import{r as y,a as K,o as ye,f as D,b as i,c as l,d as b,w as n,e as a,g as A,u as G,h as v,i as _,j as d,t as S,F as z,k as be,l as W,m as Y,G as P,n as we,p as xe,q as Ce}from"./index-BIJFk_Lq.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as Pe}from"./PlusCircleOutlined-2n_K5DW1.js";const Q=q=>(xe("data-v-844aee15"),q=q(),Ce(),q),Ne={style:{background:"#fff",padding:"12px",minHeight:"calc(100vh - 170px)"}},Se=Q(()=>A("h3",null,"Người dùng",-1)),Te={class:"notranslate"},$e={key:1,class:"notranslate"},Ue={key:1},Me={key:1,class:"notranslate"},Ae={key:2},qe={key:3},Be={key:4,class:"editable-row-operations"},Fe={key:0},Ve=Q(()=>A("a",null,"Hủy",-1)),De={key:1},ze=["onClick"],Oe=Q(()=>A("a",{href:"#",style:{color:"red"}},"Xóa",-1)),He=["onClick"],Le=["onClick"],Re=["onClick"],Ke={__name:"Home",setup(q){const I=y([{_id:"1",username:"admin",phone:"0123456789",email:"admin@gmail.com"}]),T=y({pageSize:10,showSizeChanger:!1,showQuickJumper:!1,showTotal:t=>`Total ${t} items`}),g=y(null),Z=[{title:"Tên đăng nhập",dataIndex:"username",key:"username"},{title:"IP đăng nhập",dataIndex:"ipAddress",key:"ipAddress"},{title:"Quyền",dataIndex:"role",key:"role"},{title:"Phone",dataIndex:"phone",key:"phone"},{title:"Email",dataIndex:"email",key:"email"},{title:"Mã giới thiệu",dataIndex:"inviteCode",key:"email"},{title:"Người giới thiệu",dataIndex:"userInvited",key:"userInvited",customRender:t=>{var e;return t.text?(e=t.text)==null?void 0:e.username:"Hệ thống"}},{title:"Số dư",dataIndex:"balance",key:"balance",customRender:t=>D(t.text)},{title:"Tiền lãi",dataIndex:"interest",key:"interest",customRender:t=>D(t.text)},{title:"Trạng thái",dataIndex:"status",key:"status",customRender:t=>t.text==="active"?"Kích hoạt":"Khóa"},{title:"Tạo ngày",dataIndex:"createAt",key:"createAt",customRender:t=>W(t.text)},{title:"Đăng nhập cuối",dataIndex:"lastLogin",key:"lastLogin",customRender:t=>W(t.text)},{title:"Hành động",dataIndex:"operation"}],r=K({}),ee=t=>{r[t]=Y(I.value.filter(e=>t===e.key)[0])},te=t=>{Object.assign(I.value.filter(m=>t===m.key)[0],r[t]),console.log(r[t]);const e=Y(r[t]);e.balance=e.balance.replace(/\D/g,""),C.put(`/users/${t}`,e).then(m=>{}).catch(m=>{console.log(m)}),delete r[t]},ae=t=>{delete r[t]},ne=t=>{C.delete(`/users/${t}`).then(e=>{I.value=I.value.filter(m=>m._id!==t),P.msg("Xóa thành công",{icon:1,time:3e3})}).catch(e=>{console.log(e)})};ye(()=>{C.get("/me/profile").then(t=>{g.value=t.user,C.get("/users/list").then(e=>{const m=e;I.value=m.docs.map((o,N)=>({...o,key:o._id,balance:D(o.balance),interest:o.historyBet.reduce((k,p)=>k+p.interest,0)>0?o.historyBet.reduce((k,p)=>k+p.interest,0):0})),T.value={...T.value,total:e.totalDocs+1,pageSize:e.limit,current:e.page,showSizeChanger:!0,showQuickJumper:!0,showTotal:o=>`Tổng kết qủa ${e.totalDocs} kết quả`}}).catch(e=>{console.log(e)})})});const c=y({bankName:"",bankAccountNumber:"",bankBranch:"",bankAccountName:""}),$=y(!1),B=y(!1),F=y(!1),se=t=>{console.log(t),c.value=t,$.value=!0},J=t=>{console.log(t),$.value=!1},oe=t=>{console.log(t),c.value=t,B.value=!0},le=t=>{console.log(t),c.value=t,F.value=!0},X=t=>{U.value=!0,C.get("/users/list",{params:{page:t.current,limit:t.pageSize,search:t.search||""}}).then(e=>{const m=e;I.value=m.docs.map((o,N)=>({...o,key:o._id,balance:D(o.balance),interest:o.historyBet.reduce((k,p)=>k+p.interest,0)>0?o.historyBet.reduce((k,p)=>k+p.interest,0):0})),T.value={...T.value,total:e.totalDocs+1,pageSize:e.limit,current:e.page,showSizeChanger:!0,showQuickJumper:!0,showTotal:o=>`Tổng kết qủa ${e.totalDocs} kết quả`},U.value=!1}).catch(e=>{console.log(e),U.value=!1})},w=K({password:"",confirmPassword:""}),x=K({password2:"",confirmPassword2:""}),ue=t=>{X(t)},O=y({search:""}),ie=t=>{console.log("Success:",t)},U=y(!1),re=t=>{U.value=!0,console.log(t),X({current:1,pageSize:10,search:t})},de=t=>{console.log("Success:",t),C.put(`/users/change-password/${c.value._id}`,{password:w.password,confirmPassword:w.confirmPassword}).then(e=>{P.msg("Thay đổi mật khẩu thành công",{icon:1,time:3e3}),B.value=!1}).catch(e=>{console.log(e),P.msg(e.response.data.message,{icon:2,time:3e3})})},ce=t=>{C.put(`/users/change-password-withdraw/${c.value._id}`,{password2:x.password2,confirmPassword2:x.confirmPassword2}).then(e=>{P.msg("Thay đổi mật khẩu thành công",{icon:1,time:3e3}),F.value=!1}).catch(e=>{console.log(e),P.msg(e.response.data.message,{icon:2,time:3e3})})},me=t=>{console.log("Success:",t),C.put(`/users/change-bank/${c.value._id}`,t).then(e=>{P.msg("Thay đổi ngân hàng thành công",{icon:1,time:3e3}),$.value=!1}).catch(e=>{console.log(e),P.msg(e.response.data.message,{icon:2,time:3e3})})};return(t,e)=>{const m=i("a-input-search"),o=i("a-form-item"),N=i("a-form"),k=i("a-col"),p=i("a-button"),j=i("router-link"),pe=i("a-row"),H=i("a-input"),M=i("a-select-option"),L=i("a-select"),he=i("a-typography-link"),E=i("a-popconfirm"),ve=i("a-table"),_e=i("a-layout-content"),R=i("a-modal"),V=i("a-input-password"),ge=i("a-layout");return l(),b(ge,null,{default:n(()=>[a(ke,{selectedKeys:["1"]}),a(_e,{style:{padding:"20px 50px"}},{default:n(()=>[A("div",Ne,[Se,a(pe,null,{default:n(()=>[a(k,{span:12},{default:n(()=>[a(N,{layout:"vertical",model:O.value,autocomplete:"off",onFinish:ie},{default:n(()=>[a(o,{value:O.value.search,"onUpdate:value":e[0]||(e[0]=s=>O.value.search=s)},{default:n(()=>[a(m,{onSearch:re,placeholder:"Tìm kiếm",loading:U.value,"enter-button":""},null,8,["loading"])]),_:1},8,["value"])]),_:1},8,["model"])]),_:1}),g.value&&g.value.permissions.user.includes("create")?(l(),b(k,{key:0,span:12,style:{"text-align":"right"}},{default:n(()=>[a(j,{to:"/user/create"},{default:n(()=>[a(p,{type:"primary"},{default:n(()=>[a(G(Pe)),v(" Thêm người dùng ")]),_:1})]),_:1})]),_:1})):_("",!0)]),_:1}),g.value?(l(),b(ve,{key:0,onChange:ue,columns:Z,"data-source":I.value,bordered:"",pagination:T.value,scroll:{x:1500,y:700}},{bodyCell:n(({column:s,text:f,record:u})=>[["username"].includes(s.dataIndex)?(l(),d(z,{key:0},[g.value.permissions.user.includes("edit")?(l(),b(j,{key:0,to:`/user/${u._id}`},{default:n(()=>[A("span",Te,S(f),1)]),_:2},1032,["to"])):(l(),d("span",$e,S(f),1))],64)):_("",!0),["phone","email"].includes(s.dataIndex)?(l(),d("div",Ue,[r[u.key]?(l(),b(H,{key:0,value:r[u.key][s.dataIndex],"onUpdate:value":h=>r[u.key][s.dataIndex]=h,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(l(),d("span",Me,S(f),1))])):_("",!0),["status"].includes(s.dataIndex)?(l(),d("div",Ae,[r[u.key]?(l(),b(L,{key:0,value:r[u.key][s.dataIndex],"onUpdate:value":h=>r[u.key][s.dataIndex]=h,style:{margin:"-5px 0"}},{default:n(()=>[a(M,{value:"active"},{default:n(()=>[v("Kích hoạt")]),_:1}),a(M,{value:"inactive"},{default:n(()=>[v("Khóa")]),_:1})]),_:2},1032,["value","onUpdate:value"])):(l(),d(z,{key:1},[v(S(f),1)],64))])):_("",!0),["role"].includes(s.dataIndex)?(l(),d("div",qe,[r[u.key]?(l(),b(L,{key:0,value:r[u.key][s.dataIndex],"onUpdate:value":h=>r[u.key][s.dataIndex]=h,style:{margin:"-5px 0"}},{default:n(()=>[a(M,{value:"admin"},{default:n(()=>[v("Admin")]),_:1}),a(M,{value:"user"},{default:n(()=>[v("Người dùng")]),_:1})]),_:2},1032,["value","onUpdate:value"])):(l(),d(z,{key:1},[v(S(f),1)],64))])):s.dataIndex==="operation"?(l(),d("div",Be,[r[u.key]?(l(),d("span",Fe,[a(he,{onClick:h=>te(u.key)},{default:n(()=>[v("Lưu")]),_:2},1032,["onClick"]),a(E,{title:"Bạn có muốn hủy thao thác?",onConfirm:h=>ae(u.key)},{default:n(()=>[Ve]),_:2},1032,["onConfirm"])])):(l(),d("span",De,[g.value.permissions.user.includes("edit")?(l(),d("a",{key:0,onClick:h=>ee(u.key)},"Chỉnh sửa",8,ze)):_("",!0),g.value.permissions.user.includes("delete")?(l(),b(E,{key:1,title:"Bạn có muốn xóa người dùng này","ok-text":"Xóa","cancel-text":"Hủy",onConfirm:h=>ne(u._id)},{default:n(()=>[Oe]),_:2},1032,["onConfirm"])):_("",!0),g.value.permissions.user.includes("edit")?(l(),d("a",{key:2,onClick:h=>se(u),style:{color:"green"}},"Ngân hàng",8,He)):_("",!0),g.value.permissions.user.includes("edit")?(l(),d("a",{key:3,onClick:h=>oe(u),style:{color:"yellowgreen"}},"Mật khẩu",8,Le)):_("",!0),g.value.permissions.user.includes("edit")?(l(),d("a",{key:4,onClick:h=>le(u),style:{color:"#000"}},"Mật khẩu rút tiền",8,Re)):_("",!0)]))])):_("",!0)]),_:1},8,["data-source","pagination"])):_("",!0)])]),_:1}),a(R,{visible:$.value,"onUpdate:visible":e[4]||(e[4]=s=>$.value=s),title:"Chi tiết ngân hàng",onOk:J,footer:null},{default:n(()=>[a(N,{layout:"vertical",model:c.value,autocomplete:"off",onFinish:me},{default:n(()=>[a(o,{label:"Chọn ngân hàng",name:"bankName",rules:[{required:!0,message:"Vui lòng chọn ngân hàng"}]},{default:n(()=>[a(L,{value:c.value.bankName,"onUpdate:value":e[1]||(e[1]=s=>c.value.bankName=s)},{default:n(()=>[(l(!0),d(z,null,be(G(we),s=>(l(),b(M,{value:s.short_name,key:s.short_name},{default:n(()=>[v(S(`(${s.short_name}) ${s.name}`),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(o,{label:"Tên tài khoản",name:"bankAccountName",rules:[{required:!0,message:"Vui lòng nhập tên tài khoản"}]},{default:n(()=>[a(H,{value:c.value.bankAccountName,"onUpdate:value":e[2]||(e[2]=s=>c.value.bankAccountName=s)},null,8,["value"])]),_:1}),a(o,{label:"Số tài khoản",name:"bankAccountNumber",rules:[{required:!0,message:"Vui lòng nhập số tài khoản"}]},{default:n(()=>[a(H,{value:c.value.bankAccountNumber,"onUpdate:value":e[3]||(e[3]=s=>c.value.bankAccountNumber=s)},null,8,["value"])]),_:1}),a(o,null,{default:n(()=>[a(p,{type:"primary","html-type":"submit"},{default:n(()=>[v("Lưu")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),a(R,{visible:B.value,"onUpdate:visible":e[7]||(e[7]=s=>B.value=s),title:"Thay đổi mật khẩu",onOk:J,footer:null},{default:n(()=>[a(N,{layout:"vertical",model:w,autocomplete:"off",onFinish:de},{default:n(()=>[a(o,{label:"Mật khẩu mới",name:"password",rules:[{required:!0,message:"Vui lòng nhập mật khẩu"},{min:6,message:"Mật khẩu phải lớn hơn 6 ký tự"}]},{default:n(()=>[a(V,{value:w.password,"onUpdate:value":e[5]||(e[5]=s=>w.password=s)},null,8,["value"])]),_:1}),a(o,{label:"Nhập lại mật khẩu",name:"confirmPassword",rules:[{required:!0,message:"Vui lòng nhập lại mật khẩu"},{min:6,message:"Mật khẩu phải lớn hơn 6 ký tự"},{validator:(s,f,u)=>{f!==w.password&&u("Mật khẩu không khớp"),u()}}]},{default:n(()=>[a(V,{value:w.confirmPassword,"onUpdate:value":e[6]||(e[6]=s=>w.confirmPassword=s)},null,8,["value"])]),_:1},8,["rules"]),a(o,null,{default:n(()=>[a(p,{type:"primary","html-type":"submit"},{default:n(()=>[v("Lưu")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),a(R,{visible:F.value,"onUpdate:visible":e[10]||(e[10]=s=>F.value=s),title:"Thay đổi mật khẩu rút tiền",onOk:t.handleOk2,footer:null},{default:n(()=>[a(N,{layout:"vertical",model:x,autocomplete:"off",onFinish:ce},{default:n(()=>[a(o,{label:"Mật khẩu mới",name:"password2",rules:[{required:!0,message:"Vui lòng nhập mật khẩu"},{min:6,message:"Mật khẩu phải lớn hơn 6 ký tự"}]},{default:n(()=>[a(V,{value:x.password2,"onUpdate:value":e[8]||(e[8]=s=>x.password2=s)},null,8,["value"])]),_:1}),a(o,{label:"Nhập lại mật khẩu",name:"confirmPassword2",rules:[{required:!0,message:"Vui lòng nhập lại mật khẩu"},{min:6,message:"Mật khẩu phải lớn hơn 6 ký tự"},{validator:(s,f,u)=>{f!==x.password2&&u("Mật khẩu không khớp"),u()}}]},{default:n(()=>[a(V,{value:x.confirmPassword2,"onUpdate:value":e[9]||(e[9]=s=>x.confirmPassword2=s)},null,8,["value"])]),_:1},8,["rules"]),a(o,null,{default:n(()=>[a(p,{type:"primary","html-type":"submit"},{default:n(()=>[v("Lưu")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","onOk"]),a(fe)]),_:1})}}},We=Ie(Ke,[["__scopeId","data-v-844aee15"]]);export{We as default};
